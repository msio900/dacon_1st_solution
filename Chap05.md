# ⚾Chapter05 외국인 투수 스카우팅 최적화
## 📑contents<a id='contents'></a>
1. 문제 정의 [👉🏻](#1)
2. 탐색적 데이터 분석 [👉🏻](#2)
3. 데이터 전처리[👉🏻](#3)
4. 모델 구축과 검증[👉🏻](#4)
4. 성능 향상을 위한 방법[👉🏻](#5)
6. 정리[👉🏻](#6)

## 1_ 문제 정의[📑](#contents)<a id='1'></a>

### 1_1 경진대회 소개

| 주최자      | 데이콘, 서울대학교 통계연구소 한국야구학회 |
| ---------- | ------------------------------------------------------------ |
| 총 상금     | 200만원                                    |
| 문제 유형   | Time-Series(시계열), Recommendation(추천)  |
| 평가척도    | 전달력, 논리성, 실용성, 간결성             |
| 대회 기간   | 2019년 3월 26일 ~ 2019년 5월 20일          |
| 대회 참여팀 | 80팀                                       |

### 1_2 평가 척도

* 제출 내용은 기존의 데이콘 경진대회와 달리 모델의 예측값을 제출하는 것이 아닌 최종적으로 스카우팅하고자 하는 외국인 선수 2명을 선정하고 그 과정을 정리한 인사이트 보고서를 제출

  > * **전달력** : 코드 또는 시각화에 대한 설명이 얼마나 이해하기 쉬운지에 관한 가중치 0.5
  > * **논리력** : 어떤 선수를 스카우트할 것인지에 대한 논리력 가중치 0.4
  > * **실용성** : 인사이트와 결과물이 실제 현업에서 쓸 수 있는 것인지에 관한 가중치 0.1
  > * **간결성** : 중요한 인사이트를 얼마나 간결하고 압축적으로 잘 표현했는지(동점 발생 시)

* 각각 척도는 5점 만점

* (전달력) * 0.5 +  (논리성) * 0.4 + (실용성) * 0.1

* 동점자 발생 시 간결성 점수를 기준으로 최종 등수를 산출

### 1_3 도메인 조사

* **이닝(inning)** : 두 팀이 한경기에 참여하고 두 팀은 공격과 수비를 번갈아가면서 하는데 양 팀이 한 번식 공수를 번갈아 하는 것을 말함
  * 야구는 9 이닝 내에 최대한 많은 점수를 얻는 것을 목표로 함
* **베이스** : 야구 경기장에는 4개의 판이 다이아몬드 형태로 놓여 있는 판
* **진루** : 각각의 베이스에 도착하는 것을 말함
  * 4개의 베이스를 모두 돌아 출발점으로 돌아왔을 때 공격팀은 1점을 얻음
* 수비팀의 역할은 공격팀이 진루를 못하도록 막는 것임
  * 첫 번째는 타자가 친 공이 땅에 떨어지기 전에 수비수가 잡는 것임. 수비수가 공을 먼저 잡으면 타자는 아웃이 되어 진루할 기회가 주어지지 않음.
  * 두 번째는 투수가 스트라이크를 3번 만들어 타자를 아웃시키는 것임. 스트라이크는 크게 2개의 형태로 이루어지는데, 타자가 스윙하지 않은 상태로 투수가 던진 공이 일정한 스트라이크 존을 통과했을 때나 투수가 던진 공을 타자가 스윙했지만 배트에 공을 맞추지 못했을 때 스트라이크로 판정됨
* 타자가 출루하기 위해 가장 먼저 맞서는 상대가 투수이기 때문에 수비팀에서 투수의 역할은 매우 중요
* 이 때문에 프로구단은 선발투수를 유능한 외국인 선수로 채워 넣는 경향이 있으며, 유능한 외국인 선발투수를 스카우트하는 것이 큰 관심사 임
* 외국 리그와 국내 프로야구 리그의 환경이 달라서 단순히 외국 리그의 성적만으로는 국내 프로야구에서의 활약을 예측하기 어려우므로, 이 예측을 용이하게 해줄 인사이트 발굴을 위해 본 대회의 목적임
* **세이버메트릭스(sabermetrics)** : 미국에서 데이터 분석을 스포츠에 접목하여 생긴 학문
* 단순 경기별 지표인 평균자책점, 안타 수, 홈런 수와 투구별 데이터의 경기별 지표가 주어짐

### 1_4 문제 해결을 위한 접근 방식 소개

* 스카우팅을 하는 주된 이유
  * 선수를 영입한 첫 시즌부터 좋은 성적을 보여줄 수 있는 투수를 확보
* 스카우팅의 목적
  * 선수 육성 차원보다는 영입 직후 팀 성적 향상에 기여할 수 있는 선수를 선발
* 주어진 데이터로부터 KBO 영입 후 첫 번째 시즌에 좋은 활약을 보인 외국인 투수 그룹을 선정
* 2011년부터 2018년 사이에 활약한 외국인 투수 중 첫 번째 시즌의 평균 자책점(Earned Run Average； ERA)이 상위 50%에 속하면서, 상대 타자 수 또한 상위 50%에 속하는 그룹을 KBO에서 좋은 활약을 보인 '엘리트 투수'라고 정의
* 엘리트 투수들이 KBO에 영입되기 이전에 MLB에서의 제구력을 평가
  * 제구력이 높을수록 KBO 첫 번째 시즌의 ERA가 유의미하게 줄어든다는 점을 선형회귀분석을 통해 검증
  * 제구력은 스트라이크 존 가장자리에 분포한 투구 중 타자가 스윙하지 않은 상태 에서 스트라이크 판정된 투구 비중이 10% 이상인 구종의 개수로 정의
  * 스트라이크 판정된 가장자리 투구는 공이 날아오는 궤적이 스트라이크 존에서 벗어나 보이지만, 마지막에 궤도가 변하여 스트라이크 존에 걸친 변화구가 포함돼 있다고 볼 수 있음
  * 타자가 볼(ball)로 판정될 것이라 판단하여 스윙을 안 했지만 최종적으로 스트라이크 판정이 난 것으로 볼 수 있음
  * 이러한 투구는 투수가 목표로 하는 투구라고 가정했고, 해당 투구를 활용해 제구력을 평가
* MLB에서의 제구력이 높을수록 KBO 첫 번째 시즌의 ERA가 유의미하게 줄어든다는 인사이 트를 밝힌 후, 2019년도 신입 외국인 투수 중 MLB에서의 제구력이 가장 높은 선수를 스카우팅
* 제어 능력을 측정할 때 사용하는 구종 개수가 동등한 선수가 3명 이상일 때는 해당 선수가 타자를 아웃시킬 확률을 구해 순위를 매긴 후 상위 2명을 스카우팅할 예정
* 전체 과정을 도식화하면 다음 그림 처럼 나타낼 수 있습니다.

| 2011~2018년 데이터로 학습                                    |                                                              |                           | 2019년 데이터 적용             |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------- | ------------------------------ |
| 1                                                            | 2                                                            | 3                         | 4                              |
| KBO 첫번째 시즌에서 '좋은 활약'을 보인 투수 선정<br />(엘리트 투수) | MLB 구종 증가할 수록 KBO 첫 번째 시즌 ERA 감소<br />(엘리트 투수) | 데이터 기반 인사이트 형성 | 인사이트<br />+<br />아웃 확률 |

> **그림** 분석과정 요약 이미지

* 5.2절에서는 제공된 데이터에 대한 탐색적 데이터 분석을 진행합니다. 변수별 분포와 특성을 확인함
* 5.3절에서는 분석을 위한 데이터 전처리를 진행합니다. 통계적으로 유의미한 데이터만 걸러내 통곗값에 신뢰성을 부여함
* 5.4절에서는 모델 구축 작업을 진행합니다. 선형회귀분석을 통해 가설을 검증하고 음이항 분포를 사용해 투수가 타자를 아웃시킬 확률을 추정함
* 5.5 절에서는 모델의 성능 향상 방법을 탐구합니다. 투수 평가 시 사용 가능한 추가 지표를 알아 보고 해당 지표를 기존 모델에 추가하여 스카우팅 모델을 구축해 봄

### 1_5 분석환경 구축

| 언어        | python 3 |
| ----------- | -------- |
| ide         | anaconda |
| matplotlib  | 3.3.3    |
| numpy       | 1.18.5   |
| pandas      | 1.0.5    |
| seaborn     | 0.10.1   |
| statsmodels | 0.12.1   |

## 2_ 탐색적 데이터 분석[📑](#contents)<a id='2'></a>

* 데이터를 목적에 맞게 활용하기 위해서는 데이터에 대한 이해가 선행되어야 함
* 주어진 데이터가 어떻게 구성되는지 알아야 데이터에 최적화된 모델링을 할 수 있는데 이 장에서는 데이터를 파악하기 위한 탐색적 데이터 분석을 실습함.

> 2011년부터 2018년까지 KBO에서 활약한 외국인 투수

| 파일명                                    | 내용                                     |
| ----------------------------------------- | ---------------------------------------- |
| kbo_yearly_foreigners_2011_2018. csv      | 역대 KBO 정규시즌 성적                   |
| fangraphs_foreigners_2011_2018. csv       | KBO 입성 전 MLB에서의 역대 정규시즌 성적 |
| baseball_savant_foreigners_2011_2018. csv | KBO 입성 전 MLB에서의 스탯캐스트 데이터  |

> 2019년 신규 KBO 외국인 투수

| 파일명                               | 내용                         |
| ------------------------------------ | ---------------------------- |
| fangraphs_foreigners_2019. csv       | MLB에서의 역대 정규시즌 성적 |
| baseball_savant_foreigners_2019 .csv | MLB에서의 스탯캐스트 데이터  |

* 2011년도부터 2018년도까지 KBO에서 활약한 외국인 투수에게는 KBO와 MLB에서의 성적이 모두 주어지는 반면, 2019년도 신규 KBO 외국인 투수에게는 MLB에서의 성적만 있음
* 2018년도까지 기록된 KBO, MLB 데이터를 통해 인사이트를 형성하고, 해당 인사이트를 2019년도 MLB 데이터에 적용해 스카우팅을 실시
  * KBO 데이터 : 투수의 정규시즌별 기록
  * MLB 데이터 : 투수의 정규 시즌별 기록과 더불어 경기별 기록
  * MLB의 정규시즌별 기록은 팬그래프 (FanGraphs) 웹사이트에서 제공한 데이터이고 MLB의 경기별 기록 데이터는 최신 추적 기술 시스템인 스탯캐스트(StatCast)를 활용해 측정된 데이터
  * 경기별 투수가 던진 투구의 구속, 위치, 투구 결과, 분당 회전수 등의 정보가 기록됨

### 2_1 KBO/팬그래프 데이터에 기록된 야구 지표 분석

* 우선 KBO 정규시즌 데이터와 MLB 정규시즌 데이터에 기록된 야구 지표를 분석

  > 데이터셋 불러오기

  ``` python
  import pandas as pd
  
  #데이터셋 불러오기 
  atKbo_11_18_KboRegSsn = pd.read_csv("./data/chap05/kbo_yearly_foreigners_2011_2018.csv")
  
  atKbo_11_18_MlbTot = pd.read_csv("./data/chap05/fangraphs_foreigners_2011_2018.csv")
  
  atKbo_19_MlbTot = pd.read_csv("./data/chap05/fangraphs_foreigners_2019.csv")
  ```

  > 데이터 크기 확인

  ```python
  print(atKbo_11_18_KboRegSsn.shape)
  print(atKbo_11_18_MlbTot.shape)
  print(atKbo_19_MlbTot.shape)
  
  # 실행 결과
  (105, 11)
  (205, 19)
  (41, 19)
  ```

* atKbo_11_18_KboRegSsn 데이터에는 105개의 행이 존재하며 11 개의 열이 존재

* atKbo_11_18_MlbTot 데이터에는 205개의 행이 존재하며 19개의 열이 존재

* atKbo_19_MlbTot 데이터에는 41 개의 행이 존재하며 19개의 열이 존재

* 해당 데이터 에는 2019년에 KBO에 입성한 외국인 투수들의 MLB 기록만 있어 atKbo_11_18_MlbTot 데이터보다 행의 개수가 줄어든 것을 확인 가능

* 하지만 수집된 MLB 기록은 같으므 로 열의 개수는 동일한 것을 확인 가능

  > `pd. DataFrame.columns`를 통해 변수 확인

  ```python
  print(atKbo_11_18_KboRegSsn.columns)
  print(atKbo_11_18_MlbTot.columns)
  print(atKbo_19_MlbTot.columns)
  
  # 실행 결과
  Index(['pitcher_name', 'year', 'team', 'ERA', 'TBF', 'H', 'HR', 'BB', 'HBP',
         'SO', 'year_born'],
        dtype='object')
  Index(['pitcher_name', 'year', 'ERA', 'WAR', 'TBF', 'H', 'HR', 'BB', 'HBP',
         'SO', 'WHIP', 'BABIP', 'FIP', 'LD%', 'GB%', 'FB%', 'IFFB%', 'SwStr%',
         'Swing%'],
        dtype='object')
  Index(['pitcher_name', 'year', 'ERA', 'WAR', 'TBF', 'H', 'HR', 'BB', 'HBP',
         'SO', 'WHIP', 'BABIP', 'FIP', 'LD%', 'GB%', 'FB%', 'IFFB%', 'SwStr%',
         'Swing%'],
        dtype='object')
  ```

* KBO/팬그래프 데이터 칼럼별 상세 설명

  | 칼럼명       | 상세                                                         |
  | ------------ | ------------------------------------------------------------ |
  | pitcher_name | 투수이름                                                     |
  | year         | 연도                                                         |
  | team         | 소속팀                                                       |
  | ERA          | 평균자책점(Earned run average)                               |
  | WAR          | 대체선수 대비 승리기여도(Wins above replacement)             |
  | TBF          | 상대한 타자 수(Total battlers faced)                         |
  | H            | 피안타 수(Hits)                                              |
  | HR           | 피홈런 수(Home runs)                                         |
  | BB           | 피볼넷 수(Bases on balls)                                    |
  | HBP          | 피사구 수(Hit by pitch)                                      |
  | SO           | 삼진 수(Strikeouts)                                          |
  | year_born    | 생년월일                                                     |
  | WHIP         | 이닝당 출루 허용률(Walks plus hits divided by innings pitched) |
  | BABIP        | 인플레이 타구 안타 비율(Batting average on balls in play)    |
  | FIP          | 수비 무관 자책점(Fielding independent pitching)              |
  | LD%          | 라인드라이브 비율(Line-drive rate)                           |
  | GB%          | 땅볼 비율 (Ground-ball rate)                                 |
  | FB%          | 플라이볼 비율(Fly-ball rate)                                 |
  | IFFB%        | 플라이볼 중 인필드 플라이볼 비율(Infield fly ball rate)      |
  | SwSTR%       | 헛스윙 비율(Swinging strike rate                             |
  | Swing%       | 스윙 비율(Swing rate)                                        |

* 총 21개의 칼럼이 KBO 데이터와 팬그래프 데이터에 나뉘어 기록

* 투수의 인적 사항, 투구 결과에 대한 여러 지표들 기록

* 안타 및 볼넷에서 파생된 지표 : WHIP, BABIP 등

* 라인드라이브 : 타구의 궤적에 따라 직선으로 날아가는 방향

* 땅볼 : 땅에 맞고 흘러가는 볼

* 플라이볼 : 공중으로 높이 솟아오르는 볼

* 이번 실습에서는 추후 분석에 이용될 주요 칼럼인 ERA와 TBF에 대한 데이터 탐색을 진행

  > KBO 정규시즌의 ERA와 TBF의 분포 및 기초통계량

  ```python
  atKbo_11_18_KboRegSsn[['ERA', 'TBF']].hist()
  print(atKbo_11_18_KboRegSsn[['ERA', 'TBF']].describe())
  
  # 실행 결과
                ERA         TBF
  count  105.000000  105.000000
  mean     4.714286  558.980952
  std      1.733072  224.436816
  min      2.380000   40.000000
  25%      3.740000  349.000000
  50%      4.420000  622.000000
  75%      5.230000  758.000000
  max     15.750000  870.000000
  ```

  ![](./image/5_2_1-1.png)

* ERA는 평균값이 4.71 이며 분포가 왼쪽으로 쏠려있는 것을 확인 가능

* TBF 는 평균값이 558이고 분포가 오른쪽으로 쏠려있음

  > MLB에서 ERA와 TBF의 분포와 기초통계량

  ```python
  atKbo_11_18_MlbTot[['ERA', 'TBF']].hist()
  print(atKbo_11_18_MlbTot[['ERA', 'TBF']].describe())
  
  # 실행 결과
                ERA         TBF
  count  205.000000  205.000000
  mean     5.750585  193.160976
  std      3.404285  186.000312
  min      0.000000    4.000000
  25%      4.050000   57.000000
  50%      5.200000  126.000000
  75%      6.750000  263.000000
  max     27.000000  827.000000
  ```

  ![](./image/5_2_1-2.png)

* ERA는 평균값이 5.75이며 분포가 왼쪽으로 쏠려있는 것을 확인 가능

* 반면 TBF는 평균값이 193이고 분포는 왼쪽으로 쏠려있음

* MLB에서의 TBF 값의 평균이 KBO보다 낮고 분포 또한 왼쪽으로 몰려있는 이유는 대부분의 KBO 외국인 투수들이 MLB에서는 선발 투수가 아니었기 때문

* 투수는 크게 선발투수와 불펜투수로 나뉘는데, 선발투수가 불펜투수보다 투구할 기회가 더 많이 주어짐.

* KBO에서 외국인 투수들은 대부분 선발투수 로 배정되어 상대한 타자 수가 많아 TBF 값이 높지만, MLB에서는 대부분 불펜투수로 활동 하여 TBF 값이 낮게 측정됐다고 볼 수 있음

* 투수를 평가할 때 사용하는 대표적인 지표로는 ERA가 있음

* MLB에서 ERA가 낮을수록 KBO에서도 낮을 것이라는 것이 증명된다면 외국인 투수를 스카우팅할 때 ERA가 낮은 투수 위주로 스카우트하면 됨

* 해당 가설을 확인해 보기 위해 다음 코드를 수행

  > 투수별 각 리그에서의 ERA 평균값

  ```python
  m_mean = (atKbo_11_18_MlbTot.groupby('pitcher_name')['ERA'].
            mean().
            reset_index().
            rename(columns={'ERA':'MLB_mean'}))
  k_mean = (atKbo_11_18_KboRegSsn.groupby('pitcher_name')['ERA'].
            mean().
            reset_index().
            rename(columns={'ERA':'KBO_mean'}))
  
  df = pd.merge(m_mean, k_mean, how = 'inner', on= 'pitcher_name')
  
  df.head()
  ```

  |      | pitcher_name |  MLB_mean | KBO_mean |
  | ---: | -----------: | --------: | -------- |
  |    0 |       니퍼트 |  4.290000 | 3.6875   |
  |    1 |   다이아몬드 | 10.262500 | 4.4200   |
  |    2 |     듀브론트 |  5.106667 | 4.9200   |
  |    3 |       레나도 |  7.306667 | 6.8000   |
  |    4 |         레온 |  6.050000 | 11.2500  |

* `groupby` 함수를 통해 `pitcher_name`별로 묶어준 후 ERA에 대한 평균값을 구함

  * 그리고 `pitcher_name`을 기준으로 `merge`함수를 적용하면 각 리그에 공통적으로 등장한 투수들의 ERA 평균값만 추출되어 데이터프레임 형태로 저장
  * 투수별로 해당 리그에 머문 시간이 다르므로 하나의 값으로 변환하여 비교하기 위해 평균값을 구함 

* 다음 코드를 통해 시각화해 데이터 간의 관계를 확인

  > MLB에서의 ERA 평균과 KBO에서의 ERA 평균 간 산점도

  ```python
  df.plot(kind = 'scatter', x = 'MLB_mean', y = 'KBO_mean')
  print(df.corr())
  ```

  ![](./image/5_2_1-3.png)

* MLB에서의 ERA 평균과 KBO에서의 ERA 평균 간 산점도
  * ERA는 작을수록 좋은 수치인데, MLB에서의 성적이 좋다고 해서 KBO에서의 성적이 좋아지는 경향을 찾기가 어려움
  * 두 개의 변수 간의 상관계수 生한 0.107로 수치가 낮은 편임을 알 수 있음
  * 이러한 분석을 통해 MLB에서의 ERA만으로 KBO에서의 투수 활약을 예측하기는 어려운 것 을 알 수 있음
  * ERA 지표가 투수 능력뿐만 아니라 투수가 속한 팀의 수비 능력 및 리그의 전반적인 수준에도 영향을 받는 지표이기 때문에 이런 결과가 나온 것으로 보임
* 5.4절에서는 온전히 투수의 능력만을 반영한 새로운 지표를 구축해봄

### 2_2 스탯캐스트 데이터에 기록된 야구 지표 분석

* 스탯캐스트 데이터에 대한 탐색적 데이터 분석을 실시

  > 스탯캐스트 데이터를 불러오고 데이터 크기를 확인

  ```python
  atKbo_11_18_StatCast = pd.read_csv("data/chap05/baseball_savant_foreigners_2011_2018.csv")
  
  atKbo_19_StatCast = pd.read_csv("data/chap05/baseball_savant_foreigners_2019.csv")
  
  print(atKbo_11_18_StatCast.shape)
  print(atKbo_19_StatCast.shape)
  
  # 실행 결과
  (135753, 24)
  (21903, 24)
  ```

* 행의 갯수가 상당히 많음.

* 스탯 캐스트 데이터는 경기에서 해당 투수가 던진 모든 투구별 데이터를 기록한 것이므로 관측치 많음

  > 스탯캐스트 데이터 칼럼명 확인

  ```python
  print(atKbo_11_18_StatCast.columns)
  print(atKbo_19_StatCast.columns)
  
  # 실행 결과
  Index(['game_date', 'release_speed', 'batter', 'pitcher', 'events',
         'description', 'zone', 'stand', 'p_throws', 'bb_type', 'balls',
         'strikes', 'pfx_x', 'pfx_z', 'plate_x', 'plate_z', 'ax', 'ay', 'az',
         'launch_speed', 'launch_angle', 'release_spin_rate', 'pitch_name',
         'pitcher_name'],
        dtype='object')
  Index(['game_date', 'release_speed', 'batter', 'pitcher', 'events',
         'description', 'zone', 'stand', 'p_throws', 'bb_type', 'balls',
         'strikes', 'pfx_x', 'pfx_z', 'plate_x', 'plate_z', 'ax', 'ay', 'az',
         'launch_speed', 'launch_angle', 'release_spin_rate', 'pitch_name',
         'pitcher_name'],
        dtype='object')
  ```

* 스탯캐스트 데이터 칼럼별 상세 설명

  | 칼럼명            | 상세                                           |
  | ----------------- | ---------------------------------------------- |
  | game_date         | 경기 날짜                                      |
  | release_speed     | 구속(miles/h)                                  |
  | batter            | 타자의 고유 아이디                             |
  | pitcher           | 투수의 고유 아이디                             |
  | event             | 해당 타석의 결과                               |
  | description       | 해당 공의 결과                                 |
  | zone              | 공이 홈 플레이트를 지날 때의 위치              |
  | stand             | 타자의 손잡이                                  |
  | p_throws          | 투수의 손잡이                                  |
  | bb_type           | 타구의 유형                                    |
  | balls             | 공을 던지기 직전 볼카운트중볼수                |
  | strikes           | 공을 던지기 직전 볼카운트 중 스트라이크 수     |
  | pfx_x             | 공의 수평 움직임（피트）                       |
  | pfx_z             | 공의 수직 움직임（피트）                       |
  | plate_x           | 공이 홈 플레이트를 지날 때의 수평 위치（피트） |
  | plate_z           | 공이 홈 플레이트를 지날 때의 수직 위치（피트） |
  | ax                | 공의 가속도의 X 성분                           |
  | ay                | 공의 가속도의 y 성분                           |
  | az                | 공의 가속도의 z 성분                           |
  | launch_speed      | 타구의 속도（2015년부터 기록）                 |
  | launch_angle      | 타구의 발사각도（2015년부터 기록）             |
  | release_spin_rate | 투수가 던진 공의 회전율（2015년부터 기록）     |
  | pitch_name        | 구종                                           |
  | pitcher_name      | 투수이름                                       |

* 24개의 칼럼이 스탯캐스트 데이터에 기록

* `events`, `description`, `pitch_name`에 대한 데이터 탐색 진행

  > 스탯캐스트 주요 칼럼 내용 확인

  ```python
  atKbo_11_18_StatCast[['events', 'description', 'pitch_name']]
  ```

  |        |    events |         description | pitch_name      |
  | -----: | --------: | ------------------: | --------------- |
  |      0 | field_out |       hit_into_play | 4-Seam Fastball |
  |      1 |  home_run | hit_into_play_score | 4-Seam Fastball |
  |      2 |       NaN |                foul | 4-Seam Fastball |
  |      3 |       NaN |        blocked_ball | 4-Seam Fastball |
  |      4 |       NaN |                ball | 4-Seam Fastball |
  |    ... |       ... |                 ... | ...             |
  | 135748 |       NaN |                ball | 4-Seam Fastball |
  | 135749 | field_out |       hit_into_play | Cutter          |
  | 135750 |       NaN |       called_strike | Cutter          |
  | 135751 |       NaN |                ball | 4-Seam Fastball |
  | 135752 |       NaN |                ball | 4-Seam Fastball |

  135753 rows × 3 columns

* 해당 칼럼 모두 문자열 값이 들어 있는 것을 확인 가능

  * `pitch.name` 칼럼에는 투수 가 던진 투구의 구종명이 기록
  * `description`에는 해당 공이 스트라이크인지, 볼로 판정됐는지, 또는 타자가 안타를 쳤는지 등의 공에 대한 결과가 기록
  * `events` 칼럼에는 해당 타석의 결과가 기록

* 결과가 일어난 후에는 타자가 바뀌기 때문에 타석에 대한 결과는 타자별로 한 개만 가짐

  * 가령 타자가 출루하거나 아웃된 것 을 `events` 칼럼에 기록
  * 다음 코드로 칼럼별 값의 분포를 확인
  * 먼저 `events` 칼럼에 기록된 값들의 분포를 확인

  > dacon/ch05/eda.ipynb - events 칼럼에 기록된 값들의 분포

  ```python
  (atKbo_11_18_StatCast['events'].
   value_counts().
   sort_values(ascending = True).
   plot(kind = 'barh', figsize=(8, 8)))
  ```

  ![](./image/5_2_2-1.png)

* 타석의 결과로 `field_out`, `single`, `strikeout` 등의 문자열이 기록된 것을 확인 가능

* 그 중 `field_out`의 기록이 약 1.5만 개로 가장 많음

* `description` 칼럼의 값들을 확인

  > description 칼럼의 값

  ```python
  (atKbo_11_18_StatCast['description'].
   value_counts().
   sort_values(ascending = True).
   plot(kind = 'barh', figsize=(8, 8)))
  ```

  ![](./image/5_2_2-2.png)

* `description` 칼럼에는 공의 결과인 `ball`, `called_strike`, `foul` 등의 값이 기록

* 볼(ball)의 비중이 약 5만 개로 가장 많은 것을 확인 가능

* 다음으로는 `pitch_name` 칼럼의 값들을 확인

  > pitch_name 칼럼의 값

  ```python
  (atKbo_11_18_StatCast['pitch_name'].
   value_counts().
   sort_values(ascending = True).
   plot(kind = 'barh', figsize=(8, 8)))
  ```

  ![](./image/5_2_2-3.png)

* `pitch_name`칼럼에는 `Fastball`, `Slider`, `Changeup` 등의 다양한 구종이 기록

* `4-Seam Fastball`이 가장 많이 기록됐으며 `Slider`, `Changeup` 순으로 가장 많이 던진 것을 알 수 있음

* 지금까지 대회에서 제공한 데이터에 기록된 주요 칼럼의 값들을 살펴보았고 이러한 방법으로 다른 칼럼 또한 확인해 볼 것을 권장

* 5.3절에서는 데이터 전처리를 통해 질 좋은 데이터를 추출하는 방법을 확인

## 3_ 데이터 전처리[📑](#contents)<a id='3'></a>

* 예측 모델을 구축하는 데 사용하는 데이터 유형은 다음과 같이 나눌 수 있음.
  * 학습(train) 데이터 : 모델을 학습할 때 사용
  * 검증(validation) 데이터 :학습된 모델을 튜닝할 때 사용
  * 테스트(test) 데이터 : 모델의 성능을 시험
* 성능 좋은 모델을 구축하기 위해서는 튜닝도 중요하지만, 양질의 데이터로 구성된 학습 데이터가 필요
*  Garbage in Garbage out 현상 : 모델은 학습 데이터를 바탕으로 구축되는데, 학습 데이터의 질이 나쁘면 모델의 성능 또한 좋지 않은 현상

### 3_1 가설을 확인하기 위한 투수 집단 선정하기

* 데이터 분석에서는 논리를 바탕으로 데이터 분석을 진행해 최종 결과물을 도출해야 함

  * 가설을 세우고, 가설에 문제가 없음을 밝힘으로써 데이터 분석을 전개
  * 가설의 참 • 거 짓을 확인하기 위해서는 가설을 어떻게 정량적으로 측정할 것인지 결정

* 이번 대회에서 세운 가설은 "KBO에서 우수한 활약을 보인 투수들은 MLB에서 제구 력이 뛰어날 것이다."

* 이 가설의 참 • 거짓 판별을 위해서는 다음을 결정해야 함

  1. 가설 확인의 대상이 되는 투수는 누구인가? (3_1) 
  2. KBO에서의 우수한 활약은 어떻게 측정할 것인가? (3_2)
  3. MLB에서의 제구력은 어떻게 측정할 것인가? (4)

* 이 가설은 MLB에서의 투구 기록과 KBO에서의 투구 기록이 모두 기록된 투수에 대해서만 확인 가능

* 해당 조건에 부합하는 선수를 추출하기 위해 데이터를 살펴봄

  > 대화에서 제공한 데이터를 불러오기

  ```python
  import pandas as pd
  
  #데이터셋 불러오기 
  atKbo_11_18_KboRegSsn = pd.read_csv("data/chap05/kbo_yearly_foreigners_2011_2018.csv")
  
  atKbo_11_18_MlbTot = pd.read_csv("data/chap05/fangraphs_foreigners_2011_2018.csv")
  
  atKbo_11_18_StatCast = pd.read_csv("data/chap05/baseball_savant_foreigners_2011_2018.csv")
  
  atKbo_19_MlbTot = pd.read_csv("data/chap05/fangraphs_foreigners_2019.csv")
  
  atKbo_19_StatCast = pd.read_csv("data/chap05/baseball_savant_foreigners_2019.csv")
  ```

* `pandas` 패키지의 `read_csv()` 함수를 활용해 CSV 파일을 읽을 수 있음

* 변수별 저장된 데이터 개요

  > 2011 년부터 2018년까지 KBO에서 활약한 외국인 투수

  | 변수명                   | 내용                                 |
  | ------------------------ | ------------------------------------ |
  | atKbo_11_18_KboRegSsn    | 역대 KBO 정규시즌 성적               |
  | atKbo_11_18_MlbTot KBO   | 입성 전 MLB에서의 역대 정규시즌 성적 |
  | atKboJ1 _18_StatCast KBO | 입성 전 MLB에서의 스탯캐스트 데이터  |

  > 2019년 신규 KBO 외국인 투수

  | 변수명           | 내용                         |
  | ---------------- | ---------------------------- |
  | atKbo_19_MlbTot  | MLB에서의 역대 정규시즌 성적 |
  | atKboJ9_StatCast | MLB에서의 스탯캐스트 데이터  |

* 데이터별 상위 10개 행을 확인

* `pd.DataFrame.head()` 힘수를 통해 확인 가능

  > KBO 정규시즌 성적

  ```python
  atKbo_11_18_KboRegSsn.head(10)
  ```

  |      | pitcher_name | year | team |  ERA |  TBF |    H |   HR |   BB |  HBP |   SO | year_born |
  | ---: | -----------: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | --------: |
  |    0 |       니퍼트 | 2011 | 두산 | 2.55 |  763 |  150 |    8 |   64 |   10 |  150 |       NaN |
  |    1 |       니퍼트 | 2012 | 두산 | 3.20 |  785 |  156 |   15 |   68 |    8 |  126 |       NaN |
  |    2 |       니퍼트 | 2013 | 두산 | 3.58 |  482 |  108 |    7 |   34 |    4 |  104 |       NaN |
  |    3 |       니퍼트 | 2014 | 두산 | 3.81 |  760 |  186 |   17 |   48 |    6 |  158 |       NaN |
  |    4 |       니퍼트 | 2015 | 두산 | 5.10 |  404 |  104 |    4 |   33 |    4 |   76 |       NaN |
  |    5 |       니퍼트 | 2016 | 두산 | 2.95 |  701 |  151 |   15 |   57 |    9 |  142 |       NaN |
  |    6 |       니퍼트 | 2017 | 두산 | 4.06 |  782 |  175 |   20 |   77 |   10 |  161 |       NaN |
  |    7 |       니퍼트 | 2018 |   KT | 4.25 |  765 |  209 |   26 |   39 |    9 |  165 |       NaN |
  |    8 |   다이아몬드 | 2017 |   SK | 4.42 |  581 |  163 |   11 |   35 |    9 |   59 |       NaN |
  |    9 |     듀브론트 | 2018 | 롯데 | 4.92 |  629 |  162 |   13 |   62 |    8 |  109 |       NaN |

* KBO 기록에는 팀 소속과 더불어 연도별 ERA, TBF, H, HR 등의 지표가 기록

  > MLB 정규시즌 성적

  ```python
  atKbo_11_18_MlbTot.head(10)
  ```

  |      | pitcher_name |   year |  ERA |  WAR |   TBF |     H |   HR |   BB |  HBP |    SO | WHIP | BABIP |  FIP |   LD% |   GB% |   FB% | IFFB% | SwStr% | Swing% |
  | ---: | -----------: | -----: | ---: | ---: | ----: | ----: | ---: | ---: | ---: | ----: | ---: | ----: | ---: | ----: | ----: | ----: | ----: | -----: | -----: |
  |    0 |       오간도 | 2011.0 | 3.51 |  3.3 | 693.0 | 149.0 | 16.0 | 43.0 |  7.0 | 126.0 | 1.14 | 0.265 | 3.65 | 0.237 | 0.364 | 0.674 | 0.147 |  0.090 |  0.475 |
  |    1 |         험버 | 2011.0 | 3.75 |  3.2 | 676.0 | 151.0 | 14.0 | 41.0 |  6.0 | 116.0 | 1.18 | 0.275 | 3.58 | 0.168 | 0.471 | 0.458 | 0.094 |  0.092 |  0.463 |
  |    2 |       루카스 | 2012.0 | 3.76 |  2.8 | 827.0 | 185.0 | 13.0 | 78.0 |  1.0 | 140.0 | 1.36 | 0.289 | 3.75 | 0.203 | 0.572 | 0.707 | 0.082 |  0.062 |  0.424 |
  |    3 |   다이아몬드 | 2012.0 | 3.54 |  2.2 | 714.0 | 184.0 | 17.0 | 31.0 |  4.0 |  90.0 | 1.24 | 0.292 | 3.94 | 0.210 | 0.534 | 0.597 | 0.040 |  0.068 |  0.467 |
  |    4 |     듀브론트 | 2013.0 | 4.32 |  2.2 | 705.0 | 161.0 | 13.0 | 71.0 |  5.0 | 139.0 | 1.43 | 0.310 | 3.78 | 0.199 | 0.456 | 0.633 | 0.127 |  0.077 |  0.434 |
  |    5 |       스와잭 | 2017.0 | 2.33 |  2.2 | 303.0 |  58.0 |  6.0 | 22.0 |  2.0 |  91.0 | 1.03 | 0.286 | 2.74 | 0.155 | 0.439 | 0.485 | 0.145 |  0.142 |  0.500 |
  |    6 |     듀브론트 | 2012.0 | 4.86 |  1.3 | 709.0 | 162.0 | 24.0 | 71.0 |  5.0 | 167.0 | 1.45 | 0.312 | 4.37 | 0.234 | 0.437 | 0.635 | 0.086 |  0.096 |  0.442 |
  |    7 |       탈보트 | 2010.0 | 4.41 |  1.2 | 696.0 | 169.0 | 13.0 | 69.0 |  8.0 |  88.0 | 1.49 | 0.301 | 4.48 | 0.169 | 0.478 | 0.495 | 0.070 |  0.060 |  0.428 |
  |    8 |   비야누에바 | 2011.0 | 4.04 |  1.2 | 454.0 | 103.0 | 11.0 | 32.0 |  4.0 |  68.0 | 1.26 | 0.271 | 4.10 | 0.219 | 0.356 | 0.462 | 0.151 |  0.078 |  0.433 |
  |    9 |   비야누에바 | 2014.0 | 4.64 |  1.2 | 343.0 |  89.0 |  6.0 | 19.0 |  3.0 |  72.0 | 1.39 | 0.342 | 3.13 | 0.202 | 0.413 | 0.474 | 0.161 |  0.113 |  0.486 |

* MLB 기록에는 연도별 ERA, TBF, H, HR 등의 지표와 더불어 LD%, GB%, FB%, IFFB% 등 의 지표가 기록

  > 스탯캐스트 데이터

  ```python
  atKbo_11_18_StatCast.head(10)
  ```

  |      |  game_date | release_speed |   batter | pitcher |    events |         description | zone | stand | p_throws |    bb_type |  ... | plate_x | plate_z |      ax |     ay |      az | launch_speed | launch_angle | release_spin_rate |      pitch_name | pitcher_name |
  | ---: | ---------: | ------------: | -------: | ------: | --------: | ------------------: | ---: | ----: | -------: | ---------: | ---: | ------: | ------: | ------: | -----: | ------: | -----------: | -----------: | ----------------: | --------------: | -----------: |
  |    0 | 2010-10-09 |          93.0 | 425834.0 |  430962 | field_out |       hit_into_play |  4.0 |     R |        R |      popup |  ... |  -0.626 |   2.771 |  -6.404 | 26.077 |  -9.694 |          NaN |          NaN |               NaN | 4-Seam Fastball |       니퍼트 |
  |    1 | 2010-10-09 |          95.2 | 150289.0 |  430962 |  home_run | hit_into_play_score |  5.0 |     L |        R |   fly_ball |  ... |  -0.112 |   2.401 | -10.168 | 28.786 |  -8.895 |          NaN |          NaN |               NaN | 4-Seam Fastball |       니퍼트 |
  |    2 | 2010-10-09 |          94.3 | 150289.0 |  430962 |       NaN |                foul |  2.0 |     L |        R |        NaN |  ... |   0.272 |   3.052 |  -5.605 | 26.657 |  -7.794 |          NaN |          NaN |               NaN | 4-Seam Fastball |       니퍼트 |
  |    3 | 2010-10-09 |          94.0 | 150289.0 |  430962 |       NaN |        blocked_ball | 13.0 |     L |        R |        NaN |  ... |  -1.193 |   0.632 |  -9.099 | 30.273 |  -6.371 |          NaN |          NaN |               NaN | 4-Seam Fastball |       니퍼트 |
  |    4 | 2010-10-09 |          92.8 | 150289.0 |  430962 |       NaN |                ball | 14.0 |     L |        R |        NaN |  ... |   0.370 |   1.383 |  -5.846 | 27.290 | -11.262 |          NaN |          NaN |               NaN | 4-Seam Fastball |       니퍼트 |
  |    5 | 2010-10-09 |          80.8 | 150289.0 |  430962 |       NaN |            foul_tip | 13.0 |     L |        R |        NaN |  ... |  -1.233 |   2.059 | -10.897 | 18.539 | -20.286 |          NaN |          NaN |               NaN |        Changeup |       니퍼트 |
  |    6 | 2010-10-09 |          92.0 | 150289.0 |  430962 |       NaN |                ball |  9.0 |     L |        R |        NaN |  ... |   0.510 |   1.722 |  -6.251 | 27.786 | -10.031 |          NaN |          NaN |               NaN | 4-Seam Fastball |       니퍼트 |
  |    7 | 2010-10-09 |          92.5 | 430632.0 |  430962 | field_out |       hit_into_play | 13.0 |     L |        R | line_drive |  ... |  -1.010 |   2.212 |  -8.279 | 26.466 |  -8.376 |          NaN |          NaN |               NaN | 4-Seam Fastball |       니퍼트 |
  |    8 | 2010-10-09 |          91.2 | 430632.0 |  430962 |       NaN |                ball | 13.0 |     L |        R |        NaN |  ... |  -0.106 |   1.418 |  -9.239 | 25.490 | -13.556 |          NaN |          NaN |               NaN | 4-Seam Fastball |       니퍼트 |
  |    9 | 2010-10-09 |          91.8 | 430632.0 |  430962 |       NaN |                ball | 11.0 |     L |        R |        NaN |  ... |  -1.426 |   2.971 | -12.090 | 25.659 | -15.250 |          NaN |          NaN |               NaN | 2-Seam Fastball |       니퍼트 |

  10 rows × 24 columns

* 스탯캐스트 데이터에는 투구별 속성값이 기록된 것을 확인할 수 있습니다. 구속, 투구 결과, 구종 이름등이 기록

* 데이터별로 기록된 칼럼이 다르지만 투수의 이름 정보는 모든 데이터에서 `pitcher.name` 칼럼에 기록

* 그런데 2011년부터 2018년 사이에 기록된 데이터라서 중복된 이름 존재

* 데이터별로 고유 투수 이름을 확인하기 위해 판다스에 서 제공되는 `pd.Series.unique()` 함수를 사용

  > 고유 투수 이름 확인

  ```python
  print('KBO:', len(atKbo_11_18_KboRegSsn['pitcher_name'].unique()))
  print('MLB:', len(atKbo_11_18_MlbTot['pitcher_name'].unique()))
  print('StatCast:', len(atKbo_11_18_StatCast['pitcher_name'].unique()))
  
  # 실행 결과
  KBO: 62
  MLB: 60
  StatCast: 60
  ```

* KBO, MLB, 스탯캐스트 데이터에는 각각 62, 60, 60명의 고유 투수가 존재

* 데이터 집단별로 기록된 투수의 수가 다름

  <img src="./image/5_3_1-1.png" style="zoom:33%;" />

  > 데이터 집단별 선수 분포

* 앞에서 세운 가설을 확인하려면 MLB와 KBO에 모두 기록된 선수가 필요

* KBO, MLB. 스탯캐스트에는 각각 다른 투수가 기록

  * 예를 들어 벨레스터 선수는 MLB 데이터에만 기록이 존재하고, 리즈와 카스티요 선수는 KBO와 MLB 데이터에는 기록이 있지만 스탯캐스트 데이터에는 기록이 없음
  * 가설을 확인하기 위해 3개의 데이터 집단 모 두에서 기록이 존재하는 선수를 추출
  * 위 그림에서 중앙에 있는 57명은 KBO,  MLB, 스탯캐스트 데이터에 모두 기록된 투수이며 해당 투수 집단을 타깃(target) 집단이라고 정함

* 투수 이름은 `pitcher_name` 칼럼 에 기록돼 있으며, 데이터별 `pitcher_name`의 교집합을 구하기 위해 파이썬의 집합 연산을 사용

  > 타깃 집단에 속한 투수를 추출

  ```python
  target = (set(atKbo_11_18_KboRegSsn['pitcher_name']) & 
            set(atKbo_11_18_MlbTot['pitcher_name']) &
            set(atKbo_11_18_StatCast['pitcher_name']))
  
  print(type(target)) 
  
  target = sorted(list(target))
  
  print(type(target)) 
  
  print(len(target))
  
  # 실행 결과
  <class 'set'>
  <class 'list'>
  57
  ```

* 파이썬에서는 set 타입에 대해 집합 연산을 지원하며, `set()` 함수를 통해 다른 데이터 타입을 set으로 변환 가능

* 위의 코드에서는 Series 형태인 데이터를 set 형태로 변환한 뒤, & 연산자를 통해 교집합을 추출

* 추출된 타깃 집단에는 57명의 투수가 존재

* 이렇게 KBO, MLB, 스탯캐스트 데이터에 기록이 존재하는 타깃 집단이 추출됨

* 외국인 투수 스카우팅은 선수 육성 차원보다는 팀 성적 향상에 즉시 기여할 수 있는 선수를 찾는 것이 목적이기 때문에 해당 투수의 KBO에서의 투수 능력 측정은 KBO 첫 번째 시즌의 평균자책점을 통해 평가

  > 투수별로 KBO 첫 번째 시즌의 데이터를 추출

  ```python
  _idx = atKbo_11_18_KboRegSsn.query('pitcher_name in @target'). \
      groupby('pitcher_name')['year'].idxmin().values
  firstYearInKBO_11_18 = atKbo_11_18_KboRegSsn.loc[_idx,:]
  firstYearInKBO_11_18.head()
  ```

  |      | pitcher_name | year | team |   ERA |  TBF |    H |   HR |   BB |  HBP |   SO | year_born |
  | ---: | -----------: | ---: | ---: | ----: | ---: | ---: | ---: | ---: | ---: | ---: | --------: |
  |    0 |       니퍼트 | 2011 | 두산 |  2.55 |  763 |  150 |    8 |   64 |   10 |  150 |       NaN |
  |    8 |   다이아몬드 | 2017 |   SK |  4.42 |  581 |  163 |   11 |   35 |    9 |   59 |       NaN |
  |    9 |     듀브론트 | 2018 | 롯데 |  4.92 |  629 |  162 |   13 |   62 |    8 |  109 |       NaN |
  |   10 |       레나도 | 2017 | 삼성 |  6.80 |  243 |   70 |   11 |   27 |    6 |   28 |       NaN |
  |   11 |         레온 | 2016 | 삼성 | 11.25 |   40 |   16 |    2 |    1 |    1 |    7 |       NaN |

* KBO 데이터에서 타깃 집단에 있는 투수들을 `pd.DataFrame.query()`함수를 통해 추출
* `query()` 함수 안에는 함수 특성상 문자열이 입력돼야 함
* 문자열로는 환경에 저장된 변수 접근이 불가능하지만, 문자열 내에 특수문자 @을 사용하면 현재 환경에 있는 `target` 변수에 접근 가능
* 그후 `groupby` 함수를 통해 `pitcher_name`별로 데이터를 묶고 나서 `year` 값이 가장 작은 인덱스를 추출해 `_idx` 변수에 저장
* 가장 작은 `year` 값이 해당 투수의 KBO 첫 번째 시즌
* 추출된 인덱스를 활용해 KBO 데이터를 인덱싱하면 타깃 집단의 KBO 첫 번째 시즌 성적이 추출

### 3_2 유효한 데이터 선정하기

* 총 57명 투수의 KBO에서의 첫 번째 시즌 성적을 추출했지만 모든 투수의 기록이 유효하지는 않음 

* 예시

  * 갑과 을 중에서 가위바위보를 누가 더 잘하는지를 평가하기 위 해서는 각각의 가위바위보 승률을 확인
  * 갑은 승률이 100%이고 을은 승률이 40%라면 갑이 가위바위보를 더 잘한다고 평가 가능
  * 하지만 갑은 가위바위보를 한 번 시도했고, 을은 100번 시도했다면 갑의 승률은 신뢰성 있는 지표라고 할 수 없을 것

* 야구에서도 투수의 활약상을 평가할 때 대표적으로 쓰이는 지표는 평균자책점이고 이 지표는 낮을수록 좋은 지표

* 가위바위보에서 승률이 가위바위보를 시도해야 기록되는 것처럼 평균자책점 또한 투수가 타자를 상대해야 기록되는 지표 

* 그렇기에 평균자책점은 투수가 상대한 타자의 수(Total Batters Faced, TBF)에 영향을 받는 지표 

  |   투수 A   |   투수 B   |
  | :--------: | :--------: |
  | ERA : 2.45 | ERA : 2.00 |
  | TBF : 100  |  TBF : 20  |

  > ERA와 TBF 간의 관계

* 위의 표와 같이 투수 A와 투수 B가 있다고 가정

  * 투수 A는 ERA가 2.45고 투수 B는 2.00일 때 투수 B가 더 잘한다고 평가 가능 
  * 하지만 투수가 상대한 타자 수를 확인해 보니 투수 A는 100명의 타자를 투수 B는 20명의 타자를 상대했다는 것을 알수 있음
  * 시행 횟수가 충분하지 않기 때문에 이런 경우 투수 B의 ERA 2.00은 투수 B를 정확하게 평가하는 지표라고 보기에는 한계가 있음

* 반면, 투수 A는 100명의 타자를 상대했을 때 기록된 ERA가 2.45이므로 비교적 신뢰도가 높고 질이 좋은 데이터라고 볼 수 있음

* 여기서는 'Garbage In Garbage Out' 이론에 기반해 상대한 타자 수가 특정 횟수 이상인 기록 추출

* TBF 특성상 분산이 커서 평균으로 할 경우 이상치에 영향을 받기 때문에 특정 횟수는 타깃 집단 투수의 TBF의 중앙값으로 정의

* ERA가 전체의 중앙값 이하인 투수를 우수한 활약을 보인 투수라고 정의할 것이기 때문에 TBF뿐만 아니라 ERA도 타깃 집단 투수의 ERA의 중앙값보다 작은 기록만 추출

* ERA 또한 분산이 커서 평균 대신 중앙값을 기준함

  > TBF가 중앙값 이상이고 ERA가 중앙값 이하인 투수를 추출

  ```python
  TBF_median = firstYearInKBO_11_18['TBF'].median()
  ERA_median = firstYearInKBO_11_18['ERA'].median()
  Elite_11_18 = firstYearInKBO_11_18.query('TBF >= @TBF_median & ERA <= @ERA_median')
  Elite_11_18
  ```

  |      | pitcher_name | year | team |  ERA |  TBF |    H |   HR |   BB |  HBP |   SO |        year_born |
  | ---: | -----------: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---------------: |
  |    0 |       니퍼트 | 2011 | 두산 | 2.55 |  763 |  150 |    8 |   64 |   10 |  150 |              NaN |
  |    8 |   다이아몬드 | 2017 |   SK | 4.42 |  581 |  163 |   11 |   35 |    9 |   59 |              NaN |
  |   12 |     레이예스 | 2013 |   SK | 4.84 |  751 |  157 |   15 |   91 |    7 |  135 |              NaN |
  |   14 |       레일리 | 2015 | 롯데 | 3.91 |  768 |  182 |   20 |   57 |   15 |  134 | 1988년 06월 29일 |
  |   25 |     린드블럼 | 2015 | 롯데 | 3.56 |  861 |  196 |   28 |   52 |   12 |  180 | 1987년 06월 15일 |
  |   37 |       보우덴 | 2016 | 두산 | 3.80 |  742 |  159 |   17 |   54 |    6 |  160 |              NaN |
  |   43 |         샘슨 | 2018 | 한화 | 4.68 |  703 |  144 |   17 |   79 |    5 |  195 |              NaN |
  |   45 |         세든 | 2013 |   SK | 2.98 |  780 |  169 |   14 |   73 |   11 |  160 |              NaN |
  |   48 |         소사 | 2012 |  KIA | 3.54 |  614 |  137 |    9 |   39 |    8 |  104 |              NaN |
  |   67 |         웨버 | 2014 |   NC | 4.58 |  512 |  132 |   13 |   42 |    3 |   85 |              NaN |
  |  103 |         윌슨 | 2018 |   LG | 3.07 |  689 |  158 |   11 |   35 |    6 |  149 | 1989년 09월 25일 |
  |   75 |       탈보트 | 2012 | 삼성 | 3.97 |  584 |  136 |    8 |   54 |    5 |   68 |              NaN |
  |   79 |         팻딘 | 2017 |  KIA | 4.14 |  770 |  211 |   22 |   39 |   16 |  143 |              NaN |
  |   82 |       피가로 | 2015 | 삼성 | 3.38 |  688 |  154 |   16 |   51 |    7 |  117 |              NaN |
  |   84 |     피어밴드 | 2015 | 넥센 | 4.67 |  774 |  202 |   23 |   61 |   12 |  137 |              NaN |
  |   88 |         해커 | 2013 |   NC | 3.63 |  744 |  163 |   12 |   50 |   17 |  127 |              NaN |
  |   97 |         헥터 | 2016 |  KIA | 3.40 |  868 |  211 |    7 |   51 |    6 |  139 |              NaN |
  |  100 |     후랭코프 | 2018 | 두산 | 3.74 |  621 |  118 |   12 |   55 |   22 |  134 | 1988년 08월 27일 |

* 먼저 TBF의 중앙값과 ERA의 중앙값을 `pd.Series.median()` 함수를 통해 계산해 각각 변수 에 저장
* 그러고 나서 `pd.DataFrame.query()` 함수를 통해 데이터프레임 내에서 TBF 중앙값 이상이면서 ERA 중앙값보다 낮은 기록을 추출
* 해당 과정을 통해 총 18명의 투수 기록이 추출됐습니다 18명의 투수는 성적이 유효하게 우수한 투수
* TBF 기록이 특정 횟수보다 높은 투수들을 추출해 투수 기록의 유효성을 확보했고, ERA를 특정 지표보다 낮은 투수들을 추출해 투구 실력의 우수성을 확보
* 다음 절에서는 해당 투수들의 데이터를 활용해 평균자책점과 제구력과의 관계를 분석하고 스카우팅 모델을 구축해 봄
